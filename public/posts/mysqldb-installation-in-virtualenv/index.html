<!DOCTYPE html>
<html lang="en">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="Content-Language" content="en">

    <meta name="author" content="jtr109">
    <meta name="description" content="本人使用的是OSX，在安装MySQLdb的过程中遇到不少坑，和大家分享一下，也为以后留存。只是做一个整理，并不会有太多个人心得。多以评注为主。
MySQL Server 密码重置  本机环境 Mac OS X EI Capitan 官网 Community 版 MySQL Server 虚拟环境 virtualenv pwd: /User/jtr109/qs/
 密码重置的方式多种多样，用很多我尝试之后这个是我唯一可行的，和我有相同环境、情况的朋友可以参考：数据库之mac上mysql root密码忘记或权限错误的解决办法。
遇到这个问题主要是我装MySQL的时候不专心，传说官方dmg装完后是会提示设定密码的，不知道怎么回事，反正我本地的MySQL Server就完全进不去了，只能改密码。这篇文章讲的非常清晰，简单易懂，不做过多评论。只要每一步照做就好。此文最大的优点是不用终端运行MySQL Server，也不用考虑 kill 进程，非常适合刚刚接触相关内容的朋友。
安装 MySQLdb 首先进入你需要的路径，我们以 /User/jtr109/qs/ 为例。执行 virtualenv venv 创建虚拟环境包， source venv/bin/activate 进入虚拟环境。
注意安装模块名 我不知道为什么这个模块叫 MySQLdb，import 语句也是 import MySQLdb。但是你要注意，pip 安装语句为： pip install MySQL-python。千万不要写错。不过因为你在虚拟环境，所以玩脱了就这个环境包删了就好。这也是我为什么推崇为每个项目创建虚拟环境的原因之一。
修改 _mysql.so 追踪路径 现在你可以试着进入 python， 然后运行：
&gt;&gt;&gt; import MySQLdb Traceback (most recent call last): File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt; File &quot;/Users/jtr109/qs/venv/lib/python2.">
    <meta name="keywords" content="blog,developer,personal">

    

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Install MySQLdb in virtualenv，从入门到放弃"/>
<meta name="twitter:description" content="本人使用的是OSX，在安装MySQLdb的过程中遇到不少坑，和大家分享一下，也为以后留存。只是做一个整理，并不会有太多个人心得。多以评注为主。
MySQL Server 密码重置  本机环境 Mac OS X EI Capitan 官网 Community 版 MySQL Server 虚拟环境 virtualenv pwd: /User/jtr109/qs/
 密码重置的方式多种多样，用很多我尝试之后这个是我唯一可行的，和我有相同环境、情况的朋友可以参考：数据库之mac上mysql root密码忘记或权限错误的解决办法。
遇到这个问题主要是我装MySQL的时候不专心，传说官方dmg装完后是会提示设定密码的，不知道怎么回事，反正我本地的MySQL Server就完全进不去了，只能改密码。这篇文章讲的非常清晰，简单易懂，不做过多评论。只要每一步照做就好。此文最大的优点是不用终端运行MySQL Server，也不用考虑 kill 进程，非常适合刚刚接触相关内容的朋友。
安装 MySQLdb 首先进入你需要的路径，我们以 /User/jtr109/qs/ 为例。执行 virtualenv venv 创建虚拟环境包， source venv/bin/activate 进入虚拟环境。
注意安装模块名 我不知道为什么这个模块叫 MySQLdb，import 语句也是 import MySQLdb。但是你要注意，pip 安装语句为： pip install MySQL-python。千万不要写错。不过因为你在虚拟环境，所以玩脱了就这个环境包删了就好。这也是我为什么推崇为每个项目创建虚拟环境的原因之一。
修改 _mysql.so 追踪路径 现在你可以试着进入 python， 然后运行：
&gt;&gt;&gt; import MySQLdb Traceback (most recent call last): File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt; File &quot;/Users/jtr109/qs/venv/lib/python2."/>

    <meta property="og:title" content="Install MySQLdb in virtualenv，从入门到放弃" />
<meta property="og:description" content="本人使用的是OSX，在安装MySQLdb的过程中遇到不少坑，和大家分享一下，也为以后留存。只是做一个整理，并不会有太多个人心得。多以评注为主。
MySQL Server 密码重置  本机环境 Mac OS X EI Capitan 官网 Community 版 MySQL Server 虚拟环境 virtualenv pwd: /User/jtr109/qs/
 密码重置的方式多种多样，用很多我尝试之后这个是我唯一可行的，和我有相同环境、情况的朋友可以参考：数据库之mac上mysql root密码忘记或权限错误的解决办法。
遇到这个问题主要是我装MySQL的时候不专心，传说官方dmg装完后是会提示设定密码的，不知道怎么回事，反正我本地的MySQL Server就完全进不去了，只能改密码。这篇文章讲的非常清晰，简单易懂，不做过多评论。只要每一步照做就好。此文最大的优点是不用终端运行MySQL Server，也不用考虑 kill 进程，非常适合刚刚接触相关内容的朋友。
安装 MySQLdb 首先进入你需要的路径，我们以 /User/jtr109/qs/ 为例。执行 virtualenv venv 创建虚拟环境包， source venv/bin/activate 进入虚拟环境。
注意安装模块名 我不知道为什么这个模块叫 MySQLdb，import 语句也是 import MySQLdb。但是你要注意，pip 安装语句为： pip install MySQL-python。千万不要写错。不过因为你在虚拟环境，所以玩脱了就这个环境包删了就好。这也是我为什么推崇为每个项目创建虚拟环境的原因之一。
修改 _mysql.so 追踪路径 现在你可以试着进入 python， 然后运行：
&gt;&gt;&gt; import MySQLdb Traceback (most recent call last): File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt; File &quot;/Users/jtr109/qs/venv/lib/python2." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jtr109.github.io/posts/mysqldb-installation-in-virtualenv/" />
<meta property="article:published_time" content="2017-08-13T14:08:41+08:00" />
<meta property="article:modified_time" content="2017-08-13T14:08:41+08:00" />


    
      <base href="https://jtr109.github.io/posts/mysqldb-installation-in-virtualenv/">
    
    <title>
  Install MySQLdb in virtualenv，从入门到放弃 · jtr109&#39;s Castle
</title>

    
      <link rel="canonical" href="https://jtr109.github.io/posts/mysqldb-installation-in-virtualenv/">
    

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700%7CMerriweather:300,700%7CSource+Code+Pro:400,700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.13.0/css/all.css" integrity="sha384-Bfad6CLCknfcloXFOyFnlgtENryhrpZCe29RTifKEixXQZ38WheV+i/6YWSzkz3V" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.1/normalize.min.css" integrity="sha256-l85OmPOjvil/SOvVt3HnSSjzF1TUMyT9eV0c2BzEGzU=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://jtr109.github.io/css/coder.min.3219ef62ae52679b7a9c19043171c3cd9f523628c2a65f3ef247ee18836bc90b.css" integrity="sha256-MhnvYq5SZ5t6nBkEMXHDzZ9SNijCpl8&#43;8kfuGINryQs=" crossorigin="anonymous" media="screen" />
    

    

    

    
      <link rel="stylesheet" href="https://jtr109.github.io/css/custom.css" />
    

    

    <link rel="icon" type="image/png" href="https://jtr109.github.io/favicon/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://jtr109.github.io/favicon/favicon-16x16.png" sizes="16x16">

    <meta name="generator" content="Hugo 0.72.0" />
  </head>

  
  
  <body class="colorscheme-light"
        onload=""
  >
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://jtr109.github.io/">
      jtr109&#39;s Castle
    </a>
    
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://jtr109.github.io/posts/">Blog</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://jtr109.github.io/categories/">Categories</a>
          </li>
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://jtr109.github.io/tags/">Tags</a>
          </li>
        
      
      
    </ul>
    
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Install MySQLdb in virtualenv，从入门到放弃</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2017-08-13T14:08:41&#43;08:00'>
                August 13, 2017
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              1-minute read
            </span>
          </div>
          
          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://jtr109.github.io/tags/python/">python</a>
      <span class="separator">•</span>
    <a href="https://jtr109.github.io/tags/mysql/">mysql</a>
      <span class="separator">•</span>
    <a href="https://jtr109.github.io/tags/virtualenv/">virtualenv</a></div>

        </div>
      </header>

      <div>
        
        <p>本人使用的是OSX，在安装MySQLdb的过程中遇到不少坑，和大家分享一下，也为以后留存。只是做一个整理，并不会有太多个人心得。多以评注为主。</p>
<h1 id="mysql-server-密码重置">MySQL Server 密码重置</h1>
<blockquote>
<p>本机环境
Mac OS X EI Capitan
官网 Community 版 MySQL Server
虚拟环境 virtualenv
pwd: <code>/User/jtr109/qs/</code></p>
</blockquote>
<p><em>密码重置的方式多种多样，用很多我尝试之后这个是我唯一可行的，和我有相同环境、情况的朋友可以参考：<a href="http://blog.csdn.net/u014410695/article/details/50630233">数据库之mac上mysql root密码忘记或权限错误的解决办法</a>。</em></p>
<p>遇到这个问题主要是我装MySQL的时候不专心，传说官方dmg装完后是会<strong>提示设定密码</strong>的，不知道怎么回事，反正我本地的MySQL Server就完全进不去了，只能改密码。这篇文章讲的非常清晰，简单易懂，不做过多评论。只要每一步照做就好。此文最大的优点是不用终端运行MySQL Server，也不用考虑 kill 进程，非常适合刚刚接触相关内容的朋友。</p>
<h1 id="安装-mysqldb">安装 MySQLdb</h1>
<p>首先进入你需要的路径，我们以 <code>/User/jtr109/qs/</code> 为例。执行 <code>virtualenv venv</code> 创建虚拟环境包， <code>source venv/bin/activate</code> 进入虚拟环境。</p>
<h2 id="注意安装模块名">注意安装模块名</h2>
<p>我不知道为什么这个模块叫 MySQLdb，<code>import</code> 语句也是 <code>import MySQLdb</code>。但是你要<strong>注意</strong>，<code>pip</code> 安装语句为： <code>pip install MySQL-python</code>。千万不要写错。不过因为你在虚拟环境，所以玩脱了就这个环境包删了就好。这也是我为什么推崇为每个项目创建虚拟环境的原因之一。</p>
<h2 id="修改-_mysqlso-追踪路径">修改 <code>_mysql.so</code> 追踪路径</h2>
<p>现在你可以试着进入 python， 然后运行：</p>
<pre><code>&gt;&gt;&gt; import MySQLdb
Traceback (most recent call last):
  File &quot;&lt;stdin&gt;&quot;, line 1, in &lt;module&gt;
  File &quot;/Users/jtr109/qs/venv/lib/python2.7/site-packages/MySQLdb/__init__.py&quot;, line 19, in &lt;module&gt;
    import _mysql
ImportError: dlopen(/Users/qs/venv/lib/python2.7/site-packages/_mysql.so, 2): Library not loaded: /usr/local/opt/mysql/lib/libmysqlclient.20.dylib
  Referenced from: /Users/jtr109/qs/venv/lib/python2.7/site-packages/_mysql.so
  Reason: image not found
</code></pre>
<p>很好，你跟我遇到一样的问题了。</p>
<p><em>此时你需要的是这篇文章：<a href="http://www.jianshu.com/p/e196d25a8e31">Mac OS X下修复Reason: image not found</a>。当然，更重要的是里面给的另一个链接： <a href="http://stackoverflow.com/a/13421926">Python mysqldb: Library not loaded: libmysqlclient.18.dylib</a></em></p>
<p>试着执行：</p>
<pre><code>$ otool -L /Users/jtr109/qs/venv/lib/python2.7/site-packages/_mysql.so
/Users/jtr109/mystuff/qstrategy/venv/lib/python2.7/site-packages/_mysql.so:
    /usr/local/opt/mysql/lib/libmysqlclient.20.dylib (compatibility version 20.0.0, current version 20.0.0)
    /usr/local/opt/openssl/lib/libssl.1.0.0.dylib (compatibility version 1.0.0, current version 1.0.0)
    /usr/local/opt/openssl/lib/libcrypto.1.0.0.dylib (compatibility version 1.0.0, current version 1.0.0)
    /usr/lib/libSystem.B.dylib (compatibility version 1.0.0, current version 1226.10.1)
</code></pre>
<p><em>我的 <code>dylib</code> 是 <code>20</code> 的，请根据自身调整。</em></p>
<p>来分析一下。第一个链接讲的比较清楚了，根据报错提示也可以看出，其实就是 <code>MySQLdb</code> 调用了 <code>_mysql</code> ，但是 <code>_mysql.so</code> 并没有在默认路径 <code>/usr/local/opt/mysql/lib/libmysqlclient.20.dylib</code> 找到这个文件。那接下来我们要做的就是改变他的搜索路径：</p>
<p>注意我们需要用到的 <code>install_name_tool</code> 语句的规则如下：</p>
<pre><code>install_name_tool [-change old new] input
</code></pre>
<p>几个参数的对应关系：</p>
<p><code>dylib</code> 文件默认查找路径（<code>old</code>）: <code>usr/local/opt/mysql/lib/libmysqlclient.20.dylib</code>
我们需要 <code>dylib</code> 查找的路径（<code>new</code>）: <code>usr/local/mysql/lib/libmysqlclient.20.dylib</code>
修改的 <code>_mysql.so</code> 文件位置： <code>/Users/jtr109/qs/venv/lib/python2.7/site-packages/_mysql.so</code></p>
<p>所以执行如下语句：</p>
<pre><code>$ sudo install_name_tool -change /usr/local/opt/mysql/lib/libmysqlclient.20.dylib /usr/local/mysql/lib/libmysqlclient.20.dylib /Users/jtr109/qs/venv/lib/python2.7/site-packages/_mysql.so
</code></pre>
<p><em>这里有个很奇怪的点，两篇参考文章的 <code>old</code> 路径给的都只是文件名，我尝试下来并不能够改变 <code>_mysql.so</code> 中的查找路径。所以无论你是否按照我的语句改变查找路径，<strong>请务必</strong>再次执行 <code>otool</code> 确定 <code>_mysql.so</code> 中的查找路径是否更新了！</em></p>
<p>确认更新后，再试试在python中运行 <code>import MySQLdb</code>。问题解决！</p>
<p>Tips: 这种解决方法意味着每次你新创建的 virtuanenv 中需要用到 MySQL，你都必须修改 <code>_mysql.so</code>。第一个链接中有一个自制的脚本用来执行这一操作，我没细看，大家可以参考一下。</p>
<p>那就写到这里吧，希望大家都能跑通。</p>

      </div>


      <footer>
        


        <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "jtr109" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
        
        
      </footer>
    </article>

    <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script type="text/javascript" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/startup.js" id="MathJax-script"></script>
  <script>
    MathJax = {
      tex: {
        inlineMath: [
          ['$', '$'], ['\\(', '\\)']
        ],
        processEscapes: true,
        processEnvironments: true
      },
      options: {
        skipHtmlTags: ['script', 'noscript', 'style', 'textarea', 'pre']
      }
    };
  </script>
  </section>

      </div>

      
  <footer class="footer">
    <section class="container">
      
        <p>Welcome to My Castle.</p>
      
      
        ©
        
        2020
         jtr109 
      
      
         · 
        Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
      
      
    </section>
  </footer>

    </main>

    

    

    

  </body>

</html>
